<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ó–∞ –î–µ–Ω–∏—Ü–∞ ‚ú®</title>
<style>
    :root { --p: #ff0080; --s: #ff66cc; --gold: #ffd700; --dark-blue: #0A0A2A; }
    
    body, html { 
        margin: 0; padding: 0; width: 100%; height: 100dvh; 
        overflow: hidden; background: #000; 
        font-family: -apple-system, system-ui, sans-serif;
        touch-action: none; transition: background 4s ease-in-out;
    }

    #instruction {
        position: absolute; top: 12%; width: 100%; text-align: center;
        color: white; font-size: 19px; font-weight: 300; padding: 0 25px;
        box-sizing: border-box; z-index: 1000; text-shadow: 0 0 15px var(--p);
        opacity: 1; transition: opacity 1.5s;
    }

    .element {
        position: absolute; transform: translate(-50%, -50%) scale(0);
        cursor: pointer; border: none; background: none;
        -webkit-tap-highlight-color: transparent; 
        transition: transform 1.5s cubic-bezier(0.2, 1, 0.3, 1), opacity 1.5s;
        z-index: 500;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞ –ø—É–ª—Å–∏—Ä–∞–Ω–µ */
    @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
    .beating { animation: beat 2s infinite ease-in-out; }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ —Ñ–∞–∑–∏ */
    #game-container { position: relative; width: 100%; height: 100%; }
    
    #finalStage {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%) scale(0);
        width: 100%; text-align: center;
        z-index: 1000; transition: all 2.5s ease;
        display: flex; flex-direction: column; align-items: center;
    }

    #finalMsg {
        font-size: 38px; font-weight: 900; min-height: 80px;
        background: linear-gradient(90deg, #fff, var(--gold), var(--p), #fff);
        background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        animation: shine 5s linear infinite;
    }

    #lastHeart { font-size: 100px; filter: drop-shadow(0 0 20px var(--p)); margin-top: 20px; }
    
    #extraBtn {
        display:none; margin-top:30px; background:none; border:1px solid white; color:white; 
        padding:12px 24px; border-radius:25px; font-size:14px; opacity:0; transition:2s;
    }

    @keyframes shine { to { background-position: 200% center; } }
    .particle { position: absolute; pointer-events: none; z-index: 2000; }

    /* –ó–≤–µ–∑–¥–Ω–æ –Ω–µ–±–µ –∏ –°–∫–µ–Ω–µ—Ä */
    #starrySky, #loveScanner { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        display: none; opacity: 0; transition: opacity 2s; 
    }
    #starrySky { background: var(--dark-blue); z-index: 1500; }
    #loveScanner { 
        background: #000; z-index: 2000; 
        flex-direction: column; justify-content: center; align-items: center; 
    }

    .drawn-star { position: absolute; font-size: 30px; color: white; pointer-events: none; }
    #fingerprintHeart { 
        width: 150px; height: 150px; border: 4px solid var(--s); border-radius: 50%; 
        display: flex; justify-content: center; align-items: center; font-size: 100px; 
        box-shadow: 0 0 20px var(--s); transition: 0.5s;
    }
    #progressBar { width: 0; height: 8px; background: var(--p); border-radius: 4px; margin-top: 20px; transition: width 0.1s; }

</style>
</head>
<body>

<div id="instruction">–ó–¥—Ä–∞–≤–µ–π –î–µ–Ω–∏, –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ–º —â–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–±–µ—Ä–µ—à –Ω–∞–π-–≥–æ–ª—è–º–æ—Ç–æ —Å—ä—Ä—Ü–µ</div>

<div id="game-container"></div>

<div id="finalStage">
    <div id="finalMsg">–û–ë–ò–ß–ê–ú –¢–ï –°–õ–™–ù–¶–ï! üíñ</div>
    <div id="lastHeart" class="beating">‚ù§Ô∏è</div>
    <button id="extraBtn">–ù–∞—Ç–∏—Å–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∞ –∏–∑–Ω–µ–Ω–∞–¥–∞ ‚ú®</button>
</div>

<div id="starrySky"></div>

<div id="loveScanner">
    <div id="fingerprintHeart">‚ù§Ô∏è</div>
    <div style="color:white; margin-top:20px; font-weight:300;">–ó–∞–¥—Ä—ä–∂ –ø—Ä—ä—Å—Ç–∞ —Å–∏ —Ç—É–∫...</div>
    <div id="progressBar"></div>
</div>

<script>
    const instr = document.getElementById('instruction');
    const container = document.getElementById('game-container');
    const finalStage = document.getElementById('finalStage');
    const finalMsg = document.getElementById('finalMsg');
    const extraBtn = document.getElementById('extraBtn');
    const starrySky = document.getElementById('starrySky');
    const loveScanner = document.getElementById('loveScanner');
    const progressBar = document.getElementById('progressBar');

    let starCount = 0;
    let roseCount = 0;
    let scannerProgress = 0;
    let scannerInterval;

    // --- –°–¢–ê–†–¢: –°–¶–ï–ù–ê 1 (–°–™–†–¶–ê–¢–ê –°–ï –ü–û–Ø–í–Ø–í–ê–¢ –í–ï–î–ù–ê–ì–ê) ---
    function startScene1() {
        const hearts = [
            {t:'25%', l:'20%', s:'40px'},
            {t:'75%', l:'85%', s:'40px'},
            {t:'20%', l:'80%', s:'40px'},
            {t:'85%', l:'15%', s:'40px'}
        ];

        hearts.forEach(pos => {
            const h = document.createElement('button');
            h.innerHTML = '‚ù§Ô∏è';
            h.className = 'element';
            h.style.cssText = `top:${pos.t}; left:${pos.l}; font-size:${pos.s};`;
            container.appendChild(h);
            setTimeout(() => h.style.transform = 'translate(-50%, -50%) scale(1)', 100);
        });

        const bigH = document.createElement('button');
        bigH.innerHTML = '‚ù§Ô∏è';
        bigH.className = 'element beating';
        bigH.style.cssText = `top:50%; left:50%; font-size:110px; z-index:600;`;
        container.appendChild(bigH);
        setTimeout(() => bigH.style.transform = 'translate(-50%, -50%) scale(1)', 300);

        bigH.onclick = () => {
            burst(window.innerWidth/2, window.innerHeight/2, 'üíñ', 40);
            document.querySelectorAll('.element').forEach(el => el.style.opacity = '0');
            setTimeout(startScene2, 1500);
        };
    }

    // --- –°–¶–ï–ù–ê 2: –ù–ò–ù–û ---
    function startScene2() {
        container.innerHTML = '';
        instr.innerText = '–ì—É—à–Ω–∏ –ù–∏–Ω–æ –∑–∞ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—à';
        const nino = document.createElement('button');
        nino.innerHTML = 'üß∏';
        nino.className = 'element beating';
        nino.style.cssText = 'top:50%; left:50%; font-size:130px;';
        container.appendChild(nino);
        setTimeout(() => nino.style.transform = 'translate(-50%, -50%) scale(1)', 500);

        nino.onclick = () => {
            burst(window.innerWidth/2, window.innerHeight/2, '‚ú®', 40);
            nino.style.opacity = '0';
            setTimeout(() => startScene3(0), 1500);
        };
    }

    // --- –°–¶–ï–ù–ê 3: –ó–í–ï–ó–î–ò ---
    function startScene3(count) {
        container.innerHTML = '';
        instr.innerText = `–£–ª–æ–≤–∏ –ø–∞–¥–∞—â–∏—Ç–µ –∑–≤–µ–∑–¥–∏... (${count}/5)`;
        document.body.style.background = '#120024';
        
        if (count >= 5) {
            setTimeout(startScene4, 1500);
            return;
        }

        const s = document.createElement('div');
        s.innerHTML = '‚≠ê';
        s.className = 'element';
        s.style.cssText = `left:${15 + Math.random()*70}%; top:-50px; font-size:60px;`;
        container.appendChild(s);
        setTimeout(() => s.style.transform = 'translate(-50%, -50%) scale(1)', 100);

        let pos = -50;
        const fall = setInterval(() => {
            pos += 1.5;
            s.style.top = pos + 'px';
            if (pos > window.innerHeight) {
                clearInterval(fall);
                s.remove();
                startScene3(count);
            }
        }, 16);

        s.onclick = () => {
            clearInterval(fall);
            burst(s.offsetLeft, s.offsetTop, '‚ú®', 20);
            s.remove();
            startScene3(count + 1);
        };
    }

    // --- –°–¶–ï–ù–ê 4: –†–û–ó–ò ---
    function startScene4() {
        container.innerHTML = '';
        instr.innerText = '–ü–æ–¥–∞—Ä–∏ —Å–∏ —Ç–µ–∑–∏ —Ä–æ–∑–∏...';
        document.body.style.background = 'radial-gradient(circle, #2b002b, #000)';
        let rosesFound = 0;

        function spawn() {
            if (rosesFound >= 5) { setTimeout(showFinal, 1500); return; }
            const r = document.createElement('button');
            r.innerHTML = 'üåπ';
            r.className = 'element';
            r.style.cssText = `left:${20 + Math.random()*60}%; top:${30 + Math.random()*40}%; font-size:70px;`;
            container.appendChild(r);
            setTimeout(() => r.style.transform = 'translate(-50%, -50%) scale(1)', 200);

            r.onclick = () => {
                rosesFound++;
                burst(r.offsetLeft, r.offsetTop, 'üå∏', 20);
                r.remove();
                spawn();
            };
        }
        spawn();
    }

    // --- –§–ò–ù–ê–õ –ß–ê–°–¢ 1 ---
    function showFinal() {
        container.innerHTML = '';
        instr.style.opacity = '0';
        finalStage.style.transform = 'translate(-50%, -50%) scale(1)';
        
        setTimeout(() => {
            finalMsg.style.opacity = '0';
            setTimeout(() => {
                finalMsg.innerText = "–¢–ò –°–ò –ú–û–Ø–¢ –°–í–Ø–¢! üåç";
                finalMsg.style.opacity = '1';
                setTimeout(() => {
                    extraBtn.style.display = 'block';
                    setTimeout(() => extraBtn.style.opacity = '1', 100);
                }, 3000);
            }, 1500);
        }, 4000);

        setInterval(() => burst(Math.random()*innerWidth, Math.random()*innerHeight, '‚ù§Ô∏è', 1), 500);
    }

    // --- –§–ò–ù–ê–õ –ß–ê–°–¢ 2: –ó–í–ï–ó–î–ù–û –ù–ï–ë–ï ---
    extraBtn.onclick = () => {
        finalStage.style.opacity = '0';
        setTimeout(() => {
            finalStage.style.display = 'none';
            starrySky.style.display = 'block';
            setTimeout(() => starrySky.style.opacity = '1', 100);
            instr.innerText = '–î–æ–∫–æ—Å–Ω–∏ –Ω–µ–±–µ—Ç–æ, –∑–∞ –¥–∞ –∏–∑–ø–∏—à–µ—à –∏–º–µ—Ç–æ —Å–∏...';
            instr.style.opacity = '1';
            
            const name = "–î–ï–ù–ò–¶–ê";
            let idx = 0;
            starrySky.ontouchstart = (e) => {
                const t = e.touches[0];
                const s = document.createElement('div');
                s.className = 'drawn-star';
                s.innerText = name[idx];
                s.style.left = t.clientX + 'px';
                s.style.top = t.clientY + 'px';
                starrySky.appendChild(s);
                idx = (idx + 1) % name.length;
                burst(t.clientX, t.clientY, '‚ú®', 5);
                if (document.querySelectorAll('.drawn-star').length > 12) {
                    starrySky.ontouchstart = null;
                    setTimeout(startScanner, 2000);
                }
            };
        }, 1500);
    };

    // --- –§–ò–ù–ê–õ –ß–ê–°–¢ 3: –°–ö–ï–ù–ï–† ---
    function startScanner() {
        starrySky.style.opacity = '0';
        setTimeout(() => {
            starrySky.style.display = 'none';
            loveScanner.style.display = 'flex';
            setTimeout(() => loveScanner.style.opacity = '1', 100);
            instr.innerText = '–ó–∞–¥—Ä—ä–∂ –ø—Ä—ä—Å—Ç–∞ —Å–∏ –≤—ä—Ä—Ö—É —Å—ä—Ä—Ü–µ—Ç–æ...';
        }, 1500);
    }

    document.getElementById('fingerprintHeart').ontouchstart = (e) => {
        e.preventDefault();
        scannerInterval = setInterval(() => {
            scannerProgress += 2;
            progressBar.style.width = scannerProgress + '%';
            if (scannerProgress >= 100) {
                clearInterval(scannerInterval);
                finish();
            }
        }, 50);
    };

    document.getElementById('fingerprintHeart').ontouchend = () => {
        clearInterval(scannerInterval);
        scannerProgress = 0;
        progressBar.style.width = '0%';
    };

    function finish() {
        loveScanner.style.opacity = '0';
        setTimeout(() => {
            loveScanner.style.display = 'none';
            instr.innerText = 'ERROR: –õ–Æ–ë–û–í–¢–ê –ù–ò –ï –ë–ï–ó–ö–†–ê–ô–ù–ê! ‚ôæÔ∏è';
            instr.style.top = '50%';
            instr.style.fontSize = '24px';
            instr.style.opacity = '1';
            document.body.style.background = 'linear-gradient(45deg, #ff0080, #120024)';
            setInterval(() => burst(Math.random()*innerWidth, Math.random()*innerHeight, '‚ù§Ô∏è', 1), 200);
        }, 1500);
    }

    function burst(x, y, c, n) {
        for(let i=0; i<n; i++) {
            const p = document.createElement('div');
            p.className = 'particle'; p.innerHTML = c;
            p.style.left = x + 'px'; p.style.top = y + 'px';
            document.body.appendChild(p);
            const a = Math.random()*Math.PI*2, d = 40+Math.random()*100;
            p.animate([{transform:'translate(0,0) scale(1)', opacity:1}, 
                       {transform:`translate(${Math.cos(a)*d}px,${Math.sin(a)*d}px) scale(0)`, opacity:0}], 
                       {duration:2000}).onfinish = () => p.remove();
        }
    }

    // –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –≤–µ–¥–Ω–∞–≥–∞
    window.onload = startScene1;
</script>
</body>
</html>
