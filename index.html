<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ó–∞ –î–µ–Ω–∏—Ü–∞ ‚ú®</title>
<style>
    :root { --p: #ff0080; --s: #ff66cc; --gold: #ffd700; --dark-blue: #0A0A2A; --light-blue: #1A1A4A; }
    
    body, html { 
        margin: 0; padding: 0; width: 100%; height: 100dvh; 
        overflow: hidden; background: #000; 
        font-family: -apple-system, system-ui, sans-serif;
        touch-action: none; transition: background 4s ease-in-out;
    }

    #instruction {
        position: absolute; top: 12%; width: 100%; text-align: center;
        color: white; font-size: 19px; font-weight: 300; padding: 0 25px;
        box-sizing: border-box; z-index: 1000; text-shadow: 0 0 15px var(--p);
        transition: opacity 1.5s;
    }

    .element {
        position: absolute; transform: translate(-50%, -50%) scale(0);
        cursor: pointer; border: none; background: none;
        -webkit-tap-highlight-color: transparent; 
        transition: transform 1.5s cubic-bezier(0.2, 1, 0.3, 1), opacity 1.5s;
        z-index: 500;
    }

    @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    .beating { animation: beat 2.5s infinite ease-in-out; }

    /* –û—Å–Ω–æ–≤–µ–Ω —Ñ–∏–Ω–∞–ª–µ–Ω —Å–ª–∞–π–¥ */
    #finalStage {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%) scale(0);
        width: 100%; text-align: center;
        z-index: 1000; transition: all 2.5s ease;
        display: flex; flex-direction: column; align-items: center;
    }

    #finalMsg {
        font-size: 38px; font-weight: 900; min-height: 100px;
        background: linear-gradient(90deg, #fff, var(--gold), var(--p), #fff);
        background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        animation: shine 5s linear infinite;
        transition: opacity 2s ease;
    }

    #lastHeart { font-size: 100px; filter: drop-shadow(0 0 20px var(--p)); margin-top: 20px; }
    #extraBtn {
        display:none; margin-top:30px; background:none; border:1px solid white; color:white; padding:10px 20px; 
        border-radius:20px; font-size:14px; opacity:0; transition:2s; z-index:1100;
    }

    @keyframes shine { to { background-position: 200% center; } }
    .particle { position: absolute; pointer-events: none; z-index: 2000; }
    .game-item { position: absolute; font-size: 60px; z-index: 600; cursor: pointer; transform: translate(-50%, -50%) scale(0); transition: 1.5s; }

    /* –ó–≤–µ–∑–¥–Ω–æ –Ω–µ–±–µ */
    #starrySky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-blue); z-index: 1500; opacity: 0; transition: opacity 2s; }
    .drawn-star { position: absolute; font-size: 30px; color: white; text-shadow: 0 0 10px rgba(255,255,255,0.8); pointer-events: none; animation: starFade 1s forwards; }
    @keyframes starFade { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
    .star-line { position: absolute; background: var(--gold); height: 2px; transform-origin: left center; pointer-events: none; opacity: 0.8; transition: opacity 1s; }
    
    /* –õ—é–±–æ–≤–µ–Ω —Å–∫–µ–Ω–µ—Ä */
    #loveScanner { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; opacity: 0; transition: opacity 2s; display: flex; justify-content: center; align-items: center; flex-direction: column; }
    #fingerprintHeart { width: 150px; height: 150px; border: 5px solid var(--s); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 120px; color: var(--s); box-shadow: 0 0 30px var(--s); animation: pulseGlow 1.5s infinite alternate; }
    @keyframes pulseGlow { from { box-shadow: 0 0 20px var(--s); } to { box-shadow: 0 0 50px var(--p); } }
    #scannerText { color: white; font-size: 18px; margin-top: 20px; opacity: 0; transition: opacity 1s; }
    #progressBar { width: 0; height: 10px; background: linear-gradient(90deg, var(--s), var(--p)); border-radius: 5px; margin-top: 20px; transition: width 0.1s linear; }

</style>
</head>
<body>

<div id="instruction">–ó–¥—Ä–∞–≤–µ–π –î–µ–Ω–∏, –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ–º —â–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–±–µ—Ä–µ—à –Ω–∞–π-–≥–æ–ª—è–º–æ—Ç–æ —Å—ä—Ä—Ü–µ</div>

<div id="game-container"></div>

<div id="finalStage">
    <div id="finalMsg">–û–ë–ò–ß–ê–ú –¢–ï –°–õ–™–ù–¶–ï! üíñ</div>
    <div id="lastHeart" class="beating">‚ù§Ô∏è</div>
    <button id="extraBtn">–ù–∞—Ç–∏—Å–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∞ –∏–∑–Ω–µ–Ω–∞–¥–∞ ‚ú®</button>
</div>

<div id="starrySky"></div>
<div id="loveScanner">
    <div id="fingerprintHeart">‚ù§Ô∏è</div>
    <div id="scannerText">–ó–∞–¥—Ä—ä–∂ –ø—Ä—ä—Å—Ç–∞ —Å–∏ —Ç—É–∫, –∑–∞ –¥–∞ –∏–∑–º–µ—Ä–∏—à –ª—é–±–æ–≤—Ç–∞ –Ω–∏...</div>
    <div id="progressBar" style="width:0;"></div>
</div>

<script>
    const instr = document.getElementById('instruction');
    const container = document.getElementById('game-container');
    const finalStage = document.getElementById('finalStage');
    const finalMsg = document.getElementById('finalMsg');
    const extraBtn = document.getElementById('extraBtn');
    const starrySky = document.getElementById('starrySky');
    const loveScanner = document.getElementById('loveScanner');
    const fingerprintHeart = document.getElementById('fingerprintHeart');
    const scannerText = document.getElementById('scannerText');
    const progressBar = document.getElementById('progressBar');

    let starCount = 0;
    let roseCount = 0;
    let starsDrawn = []; // –ó–∞ –¥–∞ —Å–ª–µ–¥–∏–º –Ω–∞—Ä–∏—Å—É–≤–∞–Ω–∏—Ç–µ –∑–≤–µ–∑–¥–∏
    let touchPoints = []; // –ó–∞ –∑–≤–µ–∑–¥–Ω–æ—Ç–æ –Ω–µ–±–µ
    let scannerInterval;
    let scannerProgress = 0;

    function clearScene() {
        container.innerHTML = '';
        const currentParticles = document.querySelectorAll('.particle');
        currentParticles.forEach(p => p.remove());
    }

    // --- –°–¢–ê–†–¢ –ù–ê –ò–ì–†–ê–¢–ê ---
    function initGame() {
        instr.style.opacity = 1;
        startScene1();
    }

    // --- –°–¶–ï–ù–ê 1: –°–™–†–¶–ê–¢–ê ---
    function startScene1() {
        clearScene();
        document.body.style.background = '#000';
        const positions = [
            {t:'25%', l:'20%', size:'45px'}, {t:'75%', l:'85%', size:'45px'}, {t:'20%', l:'80%', size:'45px'}, {t:'85%', l:'15%', size:'45px'}
        ];
        positions.forEach(pos => {
            const h = document.createElement('button');
            h.innerHTML = '‚ù§Ô∏è';
            h.className = 'element';
            h.style.cssText = `top:${pos.t}; left:${pos.l}; font-size:${pos.size};`;
            container.appendChild(h);
            setTimeout(() => h.style.transform = 'translate(-50%, -50%) scale(1)', 500 + Math.random()*300);
        });

        const bigH = document.createElement('button');
        bigH.innerHTML = '‚ù§Ô∏è';
        bigH.className = 'element beating';
        bigH.style.cssText = `top:50%; left:50%; font-size:110px;`;
        container.appendChild(bigH);
        setTimeout(() => bigH.style.transform = 'translate(-50%, -50%) scale(1)', 1000);

        bigH.onclick = () => {
            burst(window.innerWidth/2, window.innerHeight/2, 'üíñ', 40);
            document.querySelectorAll('.element').forEach(el => el.style.opacity = '0');
            setTimeout(() => {
                clearScene();
                startScene2();
            }, 2000); // –ü–æ-–±–∞–≤–µ–Ω –ø—Ä–µ—Ö–æ–¥
        };
    }

    // --- –°–¶–ï–ù–ê 2: –ù–ò–ù–û ---
    function startScene2() {
        instr.style.opacity = 0;
        setTimeout(() => {
            instr.innerText = '–ì—É—à–Ω–∏ –ù–∏–Ω–æ –∑–∞ –¥–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—à';
            instr.style.opacity = 1;
            const nino = document.createElement('button');
            nino.innerHTML = 'üß∏';
            nino.className = 'element beating';
            nino.style.cssText = 'top:50%; left:50%; font-size:130px;';
            container.appendChild(nino);
            setTimeout(() => nino.style.transform = 'translate(-50%, -50%) scale(1)', 1000);

            nino.onclick = () => {
                burst(window.innerWidth/2, window.innerHeight/2, '‚ú®', 50);
                nino.style.opacity = '0';
                setTimeout(() => {
                    clearScene();
                    startScene3(0);
                }, 2000); // –ü–æ-–±–∞–≤–µ–Ω –ø—Ä–µ—Ö–æ–¥
            };
        }, 1500);
    }

    // --- –°–¶–ï–ù–ê 3: –ó–í–ï–ó–î–ò–¢–ï (–ë–ê–í–ù–û –ü–ê–î–ê–ù–ï) ---
    function startScene3(count) {
        clearScene();
        instr.innerText = `–£–ª–æ–≤–∏ –ø–∞–¥–∞—â–∏—Ç–µ –∑–≤–µ–∑–¥–∏... (${count}/5)`;
        document.body.style.background = '#120024';
        
        if (count >= 5) {
            setTimeout(startScene4, 2000); // –ü–æ-–±–∞–≤–µ–Ω –ø—Ä–µ—Ö–æ–¥
            return;
        }

        const s = document.createElement('div');
        s.innerHTML = '‚≠ê';
        s.className = 'game-item';
        s.style.left = (15 + Math.random() * 70) + '%';
        s.style.top = '-50px';
        container.appendChild(s);
        setTimeout(() => s.style.transform = 'translate(-50%, -50%) scale(1)', 300);

        let pos = -50;
        const fall = setInterval(() => {
            pos += 1.2; // –û—â–µ –ø–æ-–±–∞–≤–Ω–æ –ø–∞–¥–∞–Ω–µ
            s.style.top = pos + 'px';
            if (pos > window.innerHeight) {
                clearInterval(fall);
                if(s.parentElement) s.remove();
                startScene3(count);
            }
        }, 20); // –ü–æ-—á–µ—Å—Ç–æ –æ–ø—Ä–µ—Å–Ω—è–≤–∞–Ω–µ –∑–∞ –ø–ª–∞–≤–Ω–æ—Å—Ç

        s.onclick = () => {
            clearInterval(fall);
            burst(s.offsetLeft, s.offsetTop, '‚ú®', 25);
            s.remove();
            startScene3(count + 1);
        };
    }

    // --- –°–¶–ï–ù–ê 4: –†–û–ó–ò–¢–ï ---
    function startScene4() {
        clearScene();
        instr.innerText = '–ü–æ–¥–∞—Ä–∏ —Å–∏ —Ç–µ–∑–∏ —Ä–æ–∑–∏...';
        document.body.style.background = 'radial-gradient(circle, #2b002b, #000)';
        let rosesFound = 0;

        function spawnOneRose() {
            if (rosesFound >= 5) {
                setTimeout(showFinal, 2000); // –ü–æ-–±–∞–≤–µ–Ω –ø—Ä–µ—Ö–æ–¥
                return;
            }
            const r = document.createElement('button');
            r.innerHTML = 'üåπ';
            r.className = 'game-item';
            r.style.left = (20 + Math.random() * 60) + '%';
            r.style.top = (30 + Math.random() * 40) + '%';
            container.appendChild(r);
            setTimeout(() => r.style.transform = 'translate(-50%, -50%) scale(1.2)', 500);

            r.onclick = () => {
                rosesFound++;
                burst(r.offsetLeft, r.offsetTop, 'üå∏', 30);
                r.style.opacity = '0';
                setTimeout(() => { r.remove(); spawnOneRose(); }, 1200); // –ü–æ-–±–∞–≤–Ω–æ –∏–∑—á–µ–∑–≤–∞–Ω–µ
            };
        }
        spawnOneRose();
    }

    // --- –§–ò–ù–ê–õ: –ß–ê–°–¢ 1 ---
    function showFinal() {
        clearScene();
        instr.style.opacity = 0;
        document.body.style.background = 'radial-gradient(circle, #450021, #000)';
        
        finalStage.style.transform = 'translate(-50%, -50%) scale(1)';
        
        // –ü–æ—Å—Ç–æ—è–Ω–µ–Ω –Ω–µ–∂–µ–Ω –¥—ä–∂–¥
        setInterval(() => {
            burst(Math.random()*window.innerWidth, Math.random()*window.innerHeight, '‚ù§Ô∏è', 1);
        }, 400);

        // –£–î–™–õ–ñ–ê–í–ê–ù–ï –ù–ê –§–ò–ù–ê–õ–ê
        setTimeout(() => {
            finalMsg.style.opacity = '0';
            setTimeout(() => {
                finalMsg.innerText = "–¢–ò –°–ò –ú–û–Ø–¢ –°–í–Ø–¢! üåç";
                finalMsg.style.opacity = '1';
                
                setTimeout(() => {
                    extraBtn.style.display = 'block';
                    setTimeout(() => extraBtn.style.opacity = '1', 100);
                }, 3000);
            }, 2000);
        }, 5000);
    }

    // --- –§–ò–ù–ê–õ: –ß–ê–°–¢ 2 - –ó–í–ï–ó–î–ù–û –ù–ï–ë–ï (–í–∞—Ä–∏–∞–Ω—Ç 4) ---
    extraBtn.onclick = () => {
        extraBtn.style.opacity = '0';
        instr.style.opacity = 0;
        finalStage.style.opacity = 0;
        setTimeout(() => {
            finalStage.style.display = 'none';
            extraBtn.style.display = 'none';
            starrySky.style.opacity = 1;
            document.body.style.background = var(--dark-blue);
            instr.innerText = '–î–æ–∫–æ—Å–Ω–∏ –Ω–µ–±–µ—Ç–æ, –∑–∞ –¥–∞ –∏–∑–ø–∏—à–µ—à –∏–º–µ—Ç–æ —Å–∏...';
            instr.style.top = '5%';
            instr.style.opacity = 1;

            starrySky.addEventListener('touchstart', handleStarTouch);
        }, 2000);
    };

    const nameToDraw = "–î–ï–ù–ò–¶–ê";
    let currentLetterIndex = 0;

    function handleStarTouch(e) {
        const touch = e.touches[0];
        const x = touch.clientX;
        const y = touch.clientY;

        const star = document.createElement('div');
        star.className = 'drawn-star';
        star.innerText = nameToDraw[currentLetterIndex];
        star.style.left = x + 'px';
        star.style.top = y + 'px';
        starrySky.appendChild(star);
        starsDrawn.push(star);
        burst(x,y,'‚ú®',5); // –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω –µ—Ñ–µ–∫—Ç

        if (touchPoints.length > 0) {
            const lastPoint = touchPoints[touchPoints.length - 1];
            drawLine(lastPoint.x, lastPoint.y, x, y);
        }
        touchPoints.push({x: x, y: y});
        
        currentLetterIndex = (currentLetterIndex + 1) % nameToDraw.length;

        if (starsDrawn.length >= nameToDraw.length * 2) { // –°–ª–µ–¥ –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –±—É–∫–≤–∏
            starrySky.removeEventListener('touchstart', handleStarTouch);
            setTimeout(startLoveScanner, 3000);
        }
    }

    function drawLine(x1, y1, x2, y2) {
        const line = document.createElement('div');
        line.className = 'star-line';
        const length = Math.sqrt((x2-x1)*(x2-x1) + (y2-y1)*(y2-y1));
        const angle = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;
        
        line.style.width = length + 'px';
        line.style.left = x1 + 'px';
        line.style.top = y1 + 'px';
        line.style.transform = `rotate(${angle}deg)`;
        starrySky.appendChild(line);
    }

    // --- –§–ò–ù–ê–õ: –ß–ê–°–¢ 3 - –õ–Æ–ë–û–í–ï–ù –°–ö–ï–ù–ï–† (–í–∞—Ä–∏–∞–Ω—Ç 5) ---
    function startLoveScanner() {
        instr.style.opacity = 0;
        starrySky.style.opacity = 0;
        document.body.style.background = '#000';
        setTimeout(() => {
            starrySky.style.display = 'none';
            loveScanner.style.opacity = 1;
            scannerText.style.opacity = 1;
            instr.innerText = '–ó–∞–¥—Ä—ä–∂ –ø—Ä—ä—Å—Ç–∞ —Å–∏ –≤—ä—Ä—Ö—É —Å—ä—Ä—Ü–µ—Ç–æ...';
            instr.style.top = '12%';
            instr.style.opacity = 1;

            fingerprintHeart.addEventListener('touchstart', handleScannerStart);
            fingerprintHeart.addEventListener('touchend', handleScannerEnd);
        }, 2000);
    }

    function handleScannerStart(e) {
        e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ —Å–∫—Ä–æ–ª –Ω–∞ iOS
        scannerProgress = 0;
        progressBar.style.width = '0%';
        scannerInterval = setInterval(() => {
            scannerProgress += 2;
            progressBar.style.width = scannerProgress + '%';
            if (scannerProgress >= 100) {
                clearInterval(scannerInterval);
                finishScanner();
            }
        }, 50);
    }

    function handleScannerEnd() {
        clearInterval(scannerInterval);
        scannerProgress = 0;
        progressBar.style.width = '0%';
    }

    function finishScanner() {
        burst(window.innerWidth/2, window.innerHeight/2, 'üíñ', 100);
        scannerText.style.opacity = 0;
        fingerprintHeart.style.transform = 'scale(5)';
        fingerprintHeart.style.opacity = 0;
        progressBar.style.opacity = 0;
        
        setTimeout(() => {
            instr.innerText = 'ERROR: –õ–Æ–ë–û–í–¢–ê –ù–ò –ï –ë–ï–ó–ö–†–ê–ô–ù–ê! ‚ôæÔ∏è';
            instr.style.fontSize = '25px';
            instr.style.transition = 'none'; // –ò–∑–∫–ª—é—á–≤–∞ —Ç—Ä–∞–Ω–∑–∏—Ü–∏—è—Ç–∞ –∑–∞ –¥–∞ –µ –º–æ–º–µ–Ω—Ç–∞–ª–Ω–æ
            instr.style.top = '50%';
            instr.style.transform = 'translateY(-50%)';
            instr.style.opacity = 1;
            document.body.style.background = 'linear-gradient(45deg, var(--p), var(--s), var(--dark-blue))'; // –¶–≤–µ—Ç–µ–Ω —Ñ–æ–Ω

            // –ë–µ–∑–∫—Ä–∞–µ–Ω –¥—ä–∂–¥ –æ—Ç –µ—Ñ–µ–∫—Ç–∏ —Å–ª–µ–¥ —Ñ–∏–Ω–∞–ª–∞
            setInterval(() => {
                burst(Math.random()*window.innerWidth, Math.random()*window.innerHeight, '‚ù§Ô∏è', 1);
            }, 300);

        }, 1500);
    }

    // --- –ü–û–ú–û–©–ù–ò –§–£–ù–ö–¶–ò–ò ---
    function burst(x, y, char, count) {
        for(let i=0; i<count; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.innerHTML = char;
            p.style.left = x + 'px'; p.style.top = y + 'px';
            p.style.fontSize = (Math.random() * 20 + 10) + 'px';
            document.body.appendChild(p);
            const a = Math.random() * Math.PI * 2;
            const d = 50 + Math.random() * 150;
            p.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px) scale(0)`, opacity: 0 }
            ], { duration: 2500, easing: 'ease-out' }).onfinish = () => p.remove();
        }
    }

    // --- –°–¢–ê–†–¢ –ù–ê –ò–ì–†–ê–¢–ê –ü–†–ò –ó–ê–†–ï–ñ–î–ê–ù–ï ---
    initGame();
</script>
</body>
</html>
